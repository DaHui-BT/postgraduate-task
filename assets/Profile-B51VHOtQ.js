import{d as B,r as O,g as y,o as i,c as _,e as o,F as T,f as N,t as w,m as H,a as ee,p as K,q as Q,_ as q,s as te,j as F,h as X,D as Z,v as x,b as E,w as k,l as S,S as se,k as p,x as ae,u as R}from"./index-CBJSSvT5.js";import{h as m,P as M,a as z,F as le}from"./PTInput-DwDzYLEQ.js";const oe=c=>(K("data-v-1a9118bf"),c=c(),Q(),c),ie={class:"submission-chart"},ne={class:"calendar"},de=oe(()=>o("div",{class:"weeks"},[o("div",{class:"week"},"Mon"),o("div",{class:"week"},"Wed"),o("div",{class:"week"},"Fri")],-1)),re={class:"title"},ce=ee('<div class="operation" data-v-1a9118bf><div class="slider" data-v-1a9118bf><div class="slider-desc" data-v-1a9118bf>0</div><div style="width:120px;" data-v-1a9118bf></div><div class="slider-desc" data-v-1a9118bf>12+</div></div><div class="legend" data-v-1a9118bf><div class="level-desc" data-v-1a9118bf>less</div><div class="level level-1" data-v-1a9118bf></div><div class="level level-2" data-v-1a9118bf></div><div class="level level-3" data-v-1a9118bf></div><div class="level level-4" data-v-1a9118bf></div><div class="level level-5" data-v-1a9118bf></div><div class="level-desc" data-v-1a9118bf>more</div></div></div>',1),ue=B({__name:"SubmissionChart",props:["submission_list","profile"],setup(c){const e=c,s=O([]),a=O([]),u=y([0,12]),t=["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun","Jul"];function C(){let l=parseInt(m().format("YYYY"))-1+"-"+m().format("MM-DD"),v=m(l).format("YYYY-MM-DD"),n=m(v).weekday()||7,b=n>1?m(v).add(8-n,"days").format("YYYY-MM-DD"):v,$=m().diff(m(b),"days")+1,d=7,g=Math.ceil($/d),h=u.value[0],I=u.value[1];for(let r=0;r<g;r++){let A=r===g-1&&$%d?$%d:d,J=m(b).add(r*7,"days").format("M"),U=m(b).add(r*7+A,"days").format("M"),W=r===0?t[parseInt(J)-1]:"",L=!1;parseInt(U)-parseInt(J)&&(L=!0),r&&s[r-1].ifSwitchMonth&&(W=t[parseInt(U)-1]),s.push({columns:A,title:W,ifSwitchMonth:L,data:[]});for(let P=0;P<s[r].columns;P++){let V=m(b).add(r*7+P,"days").format("YYYY-MM-DD"),j=0;(a[V]>=h&&a[V]<I||a[V]>12&&I===12)&&(j=a[V]),s[r].data.push({number:j,date:V})}}}function D(){let f=e.submission_list;for(let l of f)s.forEach(v=>{for(let n of v.data)n.date.slice(2,n.date.length)==m(l.date).format("YY-MM-DD")&&n.number++})}function Y(f){let l="#EBEDF0";return f>=12?l="#196127":f>=8?l="#239A3B":f>=4?l="#7BC96F":f>=1?l="#C6E48B":l="#EBEDF0",l}return C(),D(),(f,l)=>(i(),_("div",ie,[o("div",ne,[de,(i(!0),_(T,null,N(s,(v,n)=>(i(),_("div",{class:"column",key:n},[o("div",re,w(v.title),1),(i(!0),_(T,null,N(v.data,(b,$)=>(i(),_("div",{class:"date-wrapper",key:$,style:H(`background:${Y(b.number)};`)},null,4))),128))]))),128))]),ce]))}}),fe=q(ue,[["__scopeId","data-v-1a9118bf"]]),_e=B({__name:"Tooltip",props:{message:{type:String,required:!0},backgroundColor:{type:String,default:"rgba(0, 0, 0, 0.75)"},textColor:{type:String,default:"white"}},setup(c){const e=y(!1);function s(){e.value=!0}function a(){e.value=!1}return(u,t)=>(i(),_("div",{class:"hover-tip-container",onMouseenter:s,onMouseleave:a},[te(u.$slots,"default",{},void 0),e.value?(i(),_("div",{key:0,class:"hover-tip-message",style:H({backgroundColor:c.backgroundColor,color:c.textColor})},w(c.message),5)):F("",!0)],32))}}),G=q(_e,[["__scopeId","data-v-21420a6c"]]),ve={class:"task-from"},me={class:"profile-task"},he={key:2,class:"profile-task-container"},ke={class:"profile-task-item-name"},pe={class:"profile-task-item-name-title"},be={class:"profile-task-item-descirbe"},ge={key:3,class:"profile-task-no"},$e={class:"task-form-content"},ye={class:"task-form-item-number"},we=B({__name:"TaskForm",setup(c){var b,$;const e=(b=X())==null?void 0:b.proxy;if(e==null||e==null)throw Error("Server, please try later");const s=new Z,a=y(!1),u=y(!1),t=y({user_id:($=s.user)==null?void 0:$.id,task_list:[]});x(()=>{var d;e.$loading.show(),(d=s.user)!=null&&d.id&&s.findOne("postgraduate-task","task",{user_id:{$eq:s.user.id}}).then(g=>{g!=null&&(t.value=g)}).catch(g=>{e.$notification.show("Error",g.error),console.log(g)}).finally(()=>{e.$loading.hide()})});function C(){t.value.task_list.push({name:"",describe:""})}function D(d){if(t.value.task_list.length==1){alert("at least one task");return}t.value.task_list.splice(d,1)}function Y(){for(let d of t.value.task_list)if(d.name.trim().length==0||d.describe.trim().length==0){alert("name or describe must not be null");return}t.value.date=new Date,e==null||e.$loading.show(),u.value?s.updateOne("postgraduate-task","task",{_id:{$eq:t.value._id}},t.value).then(()=>{e==null||e.$notification.show("Success","update task successfully!"),f()}).finally(()=>{e==null||e.$loading.hide()}):s.addOne("postgraduate-task","task",t.value).then(()=>{e==null||e.$notification.show("Success","submit task successfully!"),f()}).catch(d=>{console.log(d),e==null||e.$notification.show("Error",d.error)}).finally(()=>{e==null||e.$loading.hide()})}function f(){a.value=!1}function l(){a.value=!0,u.value=!1,t.value.task_list.push({name:"",describe:""})}function v(){a.value=!0,u.value=!0}function n(){if(!confirm("is ready to delete task!")){e==null||e.$notification.show("Canceled","operate already canceled!");return}e==null||e.$loading.show(),s.deleteOne("postgraduate-task","task",{name:{$ne:""},user_id:{$eq:s.user.id}}).then(()=>{e==null||e.$notification.show("Success","delete task successfully!"),t.value.task_list=[]}).finally(()=>{e==null||e.$loading.hide()})}return(d,g)=>(i(),_("div",ve,[o("section",me,[t.value.task_list.length>0?(i(),E(M,{key:0,class:"profile-task-edit",onClick:v},{default:k(()=>[S("Edit")]),_:1})):F("",!0),t.value.task_list.length>0?(i(),E(M,{key:1,class:"profile-task-delete",type:"danger",onClick:n},{default:k(()=>[S("Delete")]),_:1})):F("",!0),t.value.task_list.length>0?(i(),_("blockquote",he,[(i(!0),_(T,null,N(t.value.task_list,h=>(i(),_("li",{class:"profile-task-item",key:h.name},[o("div",ke,[o("p",pe,w(h.name),1)]),o("p",be,w(h.describe),1)]))),128))])):(i(),_("blockquote",ge,[S(" no task to finish, to define your "),o("span",{class:"profile-task-no-add",onClick:l},"tasks")]))]),a.value?(i(),E(se,{key:0},{default:k(()=>[p(le,{onClose:f},{form:k(()=>[o("ol",$e,[(i(!0),_(T,null,N(t.value.task_list,(h,I)=>(i(),_("li",{class:"task-form-item",key:h},[o("span",ye,w(I+1)+".",1),p(z,{class:"task-form-input",width:"150px",modelValue:h.name,"onUpdate:modelValue":r=>h.name=r,placeholder:"name"},null,8,["modelValue","onUpdate:modelValue"]),p(z,{class:"task-form-input",modelValue:h.describe,"onUpdate:modelValue":r=>h.describe=r,placeholder:"describe"},null,8,["modelValue","onUpdate:modelValue"]),p(M,{type:"danger",plain:"",circle:"",onClick:r=>D(I)},{default:k(()=>[S("-")]),_:2},1032,["onClick"])]))),128))])]),button:k(()=>[p(M,{class:"task-form-button",type:"primary",onClick:Y},{default:k(()=>[S("Submit")]),_:1}),p(M,{class:"task-form-button",onClick:C},{default:k(()=>[S("Add")]),_:1})]),_:1})]),_:1})):F("",!0)]))}}),Se=q(we,[["__scopeId","data-v-6774e8e2"]]),Me=c=>(K("data-v-e06eb0ad"),c=c(),Q(),c),Ce={class:"profile"},De={class:"profile-header"},Ye=Me(()=>o("h2",{class:"profile-header-title"},"Profile",-1)),Ie={class:"profile-info"},Ve={class:"profile-info-email"},Fe={class:"contribute"},Ee=B({__name:"Profile",setup(c){var f;const e=(f=X())==null?void 0:f.proxy;if(e==null||e==null)throw Error("Server, please try later");const s=ae(),a=new Z,u=O([]);let t=y(0),C=y(null),D=y(null);x(()=>{var l,v;if(((l=a.user)==null?void 0:l.id)==null||((v=a.user)==null?void 0:v.id)==null){alert("Please login first"),s.push({path:"/login"});return}e==null||e.$loading.show(),a.findList("postgraduate-task","submission",{user_id:{$eq:a.user.id}}).then(n=>{u.splice(0,u.length),n&&u.push(...n)}).finally(()=>{e==null||e.$loading.hide()}),a.count("postgraduate-task","submission",{date:{$gte:new Date(m().format("YYYY-MM-DD"))},user_id:{$eq:a.user.id}}).then(n=>{t.value=n})});function Y(){var l;(l=a.user)==null||l.logOut(),localStorage.clear(),s.push({path:"/"})}return(l,v)=>{var n;return i(),_("div",Ce,[o("section",De,[Ye,p(M,{class:"profile-header-logout",type:"warning",onClick:Y},{default:k(()=>[S("Logout")]),_:1})]),o("section",Ie,[o("p",Ve,w((n=R(a).user)==null?void 0:n.profile.email),1),p(G,{message:"finished total task number"},{default:k(()=>[o("p",{class:"profile-info-message",ref_key:"total_task_number",ref:C},"total: "+w(u.length),513)]),_:1}),p(G,{message:"today finished task number"},{default:k(()=>[o("p",{class:"profile-info-message",ref_key:"today_task_number",ref:D},"today: "+w(R(t)),513)]),_:1})]),p(Se),o("section",Fe,[u.length>0?(i(),E(fe,{key:0,submission_list:u},null,8,["submission_list"])):F("",!0)])])}}}),Be=q(Ee,[["__scopeId","data-v-e06eb0ad"]]);export{Be as default};
