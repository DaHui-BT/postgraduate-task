import{h as I}from"./moment-C5S46NFB.js";import{d as N,D as A,r as y,o as l,c as u,b as e,w as z,v as H,e as w,p as B,f as T,_ as D,g as L,h as K,i as O,j as P,F as x,k as M,t as f,u as Q,n as R,l as X}from"./index-VWLPA4N7.js";const W=i=>(B("data-v-05401172"),i=i(),T(),i),Z={key:0,class:"submit-table"},ee={class:"submit-container"},te=W(()=>e("h2",{class:"submit-container-title"},"Submit",-1)),se=N({__name:"SubmitTable",props:["is_submit_form_show"],emits:["submit","start_loading","stop_loading","hide_submit_form"],setup(i,{emit:p}){const c=p,m=new A,o=y({user_id:m.user.id,title:"",message:"",status:0,file_id_list:[],file_name_list:[]});function S(h){let a=h.target.files;if(a==null||a==null){alert("No files upload");return}for(let _ of a)if(_.size>500*1024*1024){alert("upload file over than 500M!");return}c("start_loading");for(let _ of a)new FormData().append("file",_),m.uploadFile("postgraduate-task","files",_).then(b=>{var C,k;(C=o.value.file_id_list)==null||C.push(b.insertedId),(k=o.value.file_name_list)==null||k.push(b.file_name)}).catch(b=>{console.log(b)}).finally(()=>{c("stop_loading")})}function g(){c("submit",o.value),o.value={},o.value.status=0,o.value.file_id_list=[],o.value.file_name_list=[]}function r(){c("hide_submit_form")}return(h,a)=>i.is_submit_form_show?(l(),u("div",Z,[e("div",ee,[e("div",{class:"submit-container-close",onClick:r},"X"),te,z(e("input",{class:"submit-container-item submit-container-item-title",type:"text",placeholder:"title","onUpdate:modelValue":a[0]||(a[0]=_=>o.value.title=_)},null,512),[[H,o.value.title]]),e("input",{class:"submit-container-item-file",id:"input-file",type:"file",multiple:"",accept:".png, .jpg, .jpeg",name:"Upload",onChange:S},null,32),z(e("textarea",{class:"submit-container-item submit-container-item-textarea",placeholder:"describe",name:"",id:"",rows:"5","onUpdate:modelValue":a[1]||(a[1]=_=>o.value.message=_)},null,512),[[H,o.value.message]]),e("button",{class:"submit-container-item submit-container-submit",onClick:g},"Submit")])])):w("",!0)}}),ie=D(se,[["__scopeId","data-v-05401172"]]),ae={class:"image-block"},le=["src"],oe=N({__name:"ImageBlock",props:["image_url"],emits:["close"],setup(i,{emit:p}){const c=i,m=p;function o(){m("close")}return(S,g)=>(l(),u("div",ae,[e("div",{class:"close",onClick:o},"X"),e("img",{src:c.image_url,alt:""},null,8,le)]))}}),ne=D(oe,[["__scopeId","data-v-7e14827f"]]),ce={},ue=i=>(B("data-v-18b1be2b"),i=i(),T(),i),de={class:"loading"},re=ue(()=>e("div",{class:"loading-spinner"},null,-1)),_e=[re];function me(i,p){return l(),u("div",de,_e)}const fe=D(ce,[["render",me],["__scopeId","data-v-18b1be2b"]]),pe=i=>(B("data-v-945c5880"),i=i(),T(),i),he={class:"submission"},be=pe(()=>e("h1",null,"This is the submission page",-1)),ge={key:2,class:"submission-content"},ve={class:"submission-collapse-container"},ke={class:"submission-collapse-func"},ye={class:"submission-collapse-func-item"},we={class:"submission-collapse-func-item"},Se={class:"submission-collapse-func-item"},$e={class:"submission-func"},Ce=["onClick"],Ie={class:"submission-func-container"},De={key:0,class:"submission-file"},xe=["onClick"],Me={class:"submission-date"},Ne={class:"submission-message"},Be={key:0,class:"submission-line"},Te={key:3,class:"empty"},Ye=N({__name:"Submission",setup(i){const p=y(!1),c=y(!1),m=y(!1),o=["submit","checked","awarded","failed"],S=["#895ef9fc","#41d6ba","#3ddf58","#f95e85fc"],g=y(null),r=L([]),h=L([]),a=new A;function _(){c.value=!0}function $(){c.value=!1}async function b(){c.value=!0,await a.findList("postgraduate-task","submission").then(t=>{h.splice(0,h.length),r.splice(0,r.length),t!=null&&h.push(...t),h.sort((n,s)=>s.date.getTime()-n.date.getTime()),h.forEach(n=>{r.length==0||r.filter(s=>s.id==I(n.date).format("YY-MM-DD")).length==0?r.push({id:I(n.date).format("YY-MM-DD"),task_list:[n]}):r.map(s=>{if(s.id==I(n.date).format("YY-MM-DD")){s.task_list.push(n);return}})})}).catch(t=>{console.log(t)}).finally(()=>{c.value=!1})}K(async()=>{await b()});function C(t){t.target.parentNode.nextElementSibling.style.display=="none"?t.target.parentNode.nextElementSibling.style.display="block":t.target.parentNode.nextElementSibling.style.display="none"}function k(t,n){let s=0;for(let v of t)v.status>=n&&s++;return s}function q(t){p.value=!0,_(),g.value=null,a.getImageUrl("postgraduate-task","files",t).then(n=>{g.value=n,$()})}function G(){g.value=null,p.value=!1,$()}function Y(t){m.value=!m.value,m.value==!1&&(t.message==null||t.title==null||t.message.trim().length==0||t.title.trim().length==0?alert("Nothing to submit! The form should be completed!"):(t.date=new Date,a.addOne("postgraduate-task","submission",t),b()))}async function J(t){if(confirm(`is ready to delete ${t.title}!`)){if(prompt("input your delete token")!="delete")return;c.value=!0,await a.findOne("postgraduate-task","submission",{_id:t._id}).then(async v=>{var d;((d=v.file_id_list)==null?void 0:d.length)>0&&await a.deleteMany("postgraduate-task","files",{_id:{$in:v.file_id_list}}),await a.deleteOne("postgraduate-task","submission",{_id:v._id}),b()}).finally(()=>{c.value=!1})}else alert("operate already canceled!")}return(t,n)=>(l(),u("div",he,[c.value?(l(),O(fe,{key:0})):w("",!0),p.value?(l(),O(ne,{key:1,image_url:g.value,onClose:G},null,8,["image_url"])):w("",!0),be,e("div",{class:"submit-button",onClick:Y},"submit"),P(ie,{is_submit_form_show:m.value,onSubmit:Y,onStart_loading:_,onStop_loading:$,onHide_submit_form:n[0]||(n[0]=s=>m.value=!1)},null,8,["is_submit_form_show"]),(r==null?void 0:r.length)>0?(l(),u("ul",ge,[(l(!0),u(x,null,M(r,(s,v)=>(l(),u("li",{class:"submission-item",key:s.id},[e("div",ve,[e("div",{class:"submission-collapse",onClick:C},f(s.id),1),e("div",ke,[e("span",ye,"Submitted: "+f(k(s.task_list,0)),1),e("span",we,"Checked: "+f(k(s.task_list,1)),1),e("span",Se,"Awarded: "+f(k(s.task_list,2)),1)])]),e("div",{class:"submission-item-container",style:X({display:v==0?"display":"none"})},[(l(!0),u(x,null,M(s.task_list,(d,E)=>{var V,F;return l(),u("div",{class:"submission-item-container-content",key:E},[e("div",$e,[e("div",{class:"submission-title",onClick:U=>J(d)},f(d.title),9,Ce),e("div",Ie,[((V=d.file_id_list)==null?void 0:V.length)>0?(l(),u("div",De,[(l(!0),u(x,null,M(d.file_name_list,(U,j)=>(l(),u("div",{class:"submission-file-item",key:j,onClick:Ee=>q(d.file_id_list[j])},f(U),9,xe))),128))])):w("",!0),e("div",Me,f(Q(I)(d.date).format("HH:mm:ss")),1),e("div",{class:R({"submission-status":!0,"submission-status-error":d.status==3}),style:X({backgroundColor:S[d.status]})},f(o[d.status]),7)])]),e("div",Ne,f(d.message),1),E!=((F=s.task_list)==null?void 0:F.length)-1?(l(),u("hr",Be)):w("",!0)])}),128))],4)]))),128))])):(l(),u("div",Te," Nothing to show! "))]))}}),Ue=D(Ye,[["__scopeId","data-v-945c5880"]]);export{Ue as default};
