import{h as $}from"./moment-C5S46NFB.js";import{d as N,D as j,a as w,c as a,b as s,w as E,v as T,i as S,o as l,p as z,g as H,_ as B,r as V,j as q,k as L,h as G,F as C,e as M,t as m,u as J,l as K,n as U,L as Q}from"./index-IeaYJXu8.js";const I=n=>(z("data-v-b9223be3"),n=n(),H(),n),R={class:"submit-form"},W={key:0},Z=I(()=>s("label",{class:"submit-form-text",for:"title"},"Input title: ",-1)),ss=I(()=>s("br",null,null,-1)),ts=I(()=>s("label",{class:"submit-form-text",for:"input-file"},"Input Picutre: ",-1)),es=I(()=>s("br",null,null,-1)),ls=I(()=>s("label",{class:"submit-form-text",for:"submit-content"},"Submit Message: ",-1)),is=N({__name:"SubmitForm",props:["is_submit_form_show"],emits:["submit","start_loading","stop_loading"],setup(n,{emit:h}){const d=h,f=n,k=new j,i=w();function g(p){let o=p.target.files;if(o==null||o==null){alert("No files upload");return}for(let u of o)if(u.size>500*1024*1024){alert("upload file over than 500M!");return}d("start_loading");for(let u of o)new FormData().append("file",u),k.uploadFile("postgraduate-task","files",u).then(b=>{var D,v;(D=i.value.file_id_list)==null||D.push(b.insertedId),(v=i.value.file_name_list)==null||v.push(b.file_name)}).catch(b=>{console.log(b)}).finally(()=>{d("stop_loading")})}function r(){d("submit",i.value),i.value={},i.value.status=0,i.value.file_id_list=[],i.value.file_name_list=[]}return(p,o)=>(l(),a("div",R,[s("div",{class:"submit-button",onClick:r},"submit"),f.is_submit_form_show?(l(),a("div",W,[Z,E(s("input",{class:"submit-form-title",id:"title",type:"text","onUpdate:modelValue":o[0]||(o[0]=u=>i.value.title=u)},null,512),[[T,i.value.title]]),ss,ts,s("input",{class:"input-file",id:"input-file",type:"file",multiple:"",accept:".png, .jpg, .jpeg",name:"Upload",onChange:g},null,32),es,ls,E(s("textarea",{class:"submit-content",id:"submit-content",rows:"10",placeholder:"input your submit message: ","onUpdate:modelValue":o[1]||(o[1]=u=>i.value.message=u)},null,512),[[T,i.value.message]])])):S("",!0)]))}}),as=B(is,[["__scopeId","data-v-b9223be3"]]),os={class:"image-block"},ns=["src"],us=N({__name:"ImageBlock",props:["image_url"],emits:["close"],setup(n,{emit:h}){const d=n,f=h;function k(){f("close")}return(i,g)=>(l(),a("div",os,[s("div",{class:"close",onClick:k},"X"),s("img",{src:d.image_url,alt:""},null,8,ns)]))}}),cs=B(us,[["__scopeId","data-v-7e14827f"]]),ds=n=>(z("data-v-c9d9adfd"),n=n(),H(),n),rs={class:"submission"},_s=ds(()=>s("h1",null,"This is the submission page",-1)),ms={key:2,class:"submission-content"},fs={class:"submission-collapse-container"},ps={class:"submission-collapse-func"},hs={class:"submission-collapse-func-item"},gs={class:"submission-collapse-func-item"},bs={class:"submission-collapse-func-item"},vs={class:"submission-func"},ks={class:"submission-title"},ys={class:"submission-func-container"},ws={key:0,class:"submission-file"},Ss=["onClick"],Is={class:"submission-date"},Ds={class:"submission-message"},$s={key:0,class:"submission-line"},xs={key:3,class:"empty"},Cs=N({__name:"Submission",setup(n){const h=w(!1),d=w(!1),f=w(!1),k=["submit","checked","awarded","failed"],i=["#895ef9fc","#41d6ba","#3ddf58","#f95e85fc"],g=w(null),r=V([]),p=V([]),o=new j;function u(){d.value=!0}function y(){d.value=!1}async function b(){u(),await o.findList("postgraduate-task","tasks").then(t=>{p.splice(0,p.length),r.splice(0,r.length),t!=null&&p.push(...t),p.sort((c,e)=>e.date.getTime()-c.date.getTime()),p.forEach(c=>{r.length==0||r.filter(e=>e.id==$(c.date).format("YY-MM-DD")).length==0?r.push({id:$(c.date).format("YY-MM-DD"),task_list:[c]}):r.map(e=>{if(e.id==$(c.date).format("YY-MM-DD")){e.task_list.push(c);return}})})}).catch(t=>{console.log(t)}).finally(()=>{y()})}q(async()=>{d.value=!0,await b()});function D(t){t.target.parentNode.nextElementSibling.style.display=="none"?t.target.parentNode.nextElementSibling.style.display="block":t.target.parentNode.nextElementSibling.style.display="none"}function v(t,c){let e=0;for(let x of t)x.status>=c&&e++;return e}function A(t){h.value=!0,u(),g.value=null,o.getImageUrl("postgraduate-task","files",t).then(c=>{g.value=c,y()})}function O(){g.value=null,h.value=!1,y()}function P(t){f.value=!f.value,f.value==!1&&(t.message==null||t.title==null||t.message.trim().length==0||t.title.trim().length==0?alert("Nothing to submit! The form should be completed!"):(t.date=new Date,o.addOne("postgraduate-task","tasks",t),b()))}return(t,c)=>(l(),a("div",rs,[d.value?(l(),L(Q,{key:0})):S("",!0),h.value?(l(),L(cs,{key:1,image_url:g.value,onClose:O},null,8,["image_url"])):S("",!0),_s,G(as,{is_submit_form_show:f.value,onSubmit:P,onStart_loading:u,onStop_loading:y},null,8,["is_submit_form_show"]),r.length>0?(l(),a("ul",ms,[(l(!0),a(C,null,M(r,(e,x)=>(l(),a("li",{class:"submission-item",key:e.id},[s("div",fs,[s("div",{class:"submission-collapse",onClick:D},m(e.id),1),s("div",ps,[s("span",hs,"Submitted: "+m(v(e.task_list,0)),1),s("span",gs,"Checked: "+m(v(e.task_list,1)),1),s("span",bs,"Awarded: "+m(v(e.task_list,2)),1)])]),s("div",{class:"submission-item-container",style:U({display:x==0?"display":"none"})},[(l(!0),a(C,null,M(e.task_list,(_,F)=>(l(),a("div",{class:"submission-item-container-content",key:F},[s("div",vs,[s("div",ks,m(_.title),1),s("div",ys,[_.file_id_list.length>0?(l(),a("div",ws,[(l(!0),a(C,null,M(_.file_name_list,(X,Y)=>(l(),a("div",{class:"submission-file-item",key:Y,onClick:Ms=>A(_.file_id_list[Y])},m(X),9,Ss))),128))])):S("",!0),s("div",Is,m(J($)(_.date).format("HH:mm:ss")),1),s("div",{class:K({"submission-status":!0,"submission-status-error":_.status==3}),style:U({backgroundColor:i[_.status]})},m(k[_.status]),7)])]),s("div",Ds,m(_.message),1),F!=e.task_list.length-1?(l(),a("hr",$s)):S("",!0)]))),128))],4)]))),128))])):(l(),a("div",xs," Nothing to show! "))]))}}),Fs=B(Cs,[["__scopeId","data-v-c9d9adfd"]]);export{Fs as default};
