import{d as w,g as q,r as $,o as d,c as r,b as o,F as V,k as B,t as g,l as E,a as se,p as H,f as K,_ as S,m as Y,e as T,n as Q,j as k,q as y,s as M,D as X,x as Z,i as N,y as ee,u as j,w as ae,z as le}from"./index-VWLPA4N7.js";import{h}from"./moment-C5S46NFB.js";const oe=e=>(H("data-v-91b47bab"),e=e(),K(),e),ne={class:"submission-chart"},ie={class:"calendar"},de=oe(()=>o("div",{class:"weeks"},[o("div",{class:"week"},"Mon"),o("div",{class:"week"},"Wed"),o("div",{class:"week"},"Fri")],-1)),ce={class:"title"},re=se('<div class="operation" data-v-91b47bab><div class="slider" data-v-91b47bab><div class="slider-desc" data-v-91b47bab>0</div><div style="width:120px;" data-v-91b47bab></div><div class="slider-desc" data-v-91b47bab>12+</div></div><div class="legend" data-v-91b47bab><div class="level-desc" data-v-91b47bab>less</div><div class="level level-1" data-v-91b47bab></div><div class="level level-2" data-v-91b47bab></div><div class="level level-3" data-v-91b47bab></div><div class="level level-4" data-v-91b47bab></div><div class="level level-5" data-v-91b47bab></div><div class="level-desc" data-v-91b47bab>more</div></div></div>',1),ue=w({__name:"SubmissionChart",props:["submission_list","profile"],setup(e){const n=e,t=q([]),p=q([]),i=$([0,12]),c=["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun","Jul"];function a(){let f=parseInt(h().format("YYYY"))-1+"-"+h().format("MM-DD"),s=h(f).format("YYYY-MM-DD"),v=h(s).weekday()||7,l=v>1?h(s).add(8-v,"days").format("YYYY-MM-DD"):s,m=h().diff(h(l),"days")+1,u=7,O=Math.ceil(m/u),te=i.value[0],P=i.value[1];for(let b=0;b<O;b++){let A=b===O-1&&m%u?m%u:u,J=h(l).add(b*7,"days").format("M"),U=h(l).add(b*7+A,"days").format("M"),W=b===0?c[parseInt(J)-1]:"",z=!1;parseInt(U)-parseInt(J)&&(z=!0),b&&t[b-1].ifSwitchMonth&&(W=c[parseInt(U)-1]),t.push({columns:A,title:W,ifSwitchMonth:z,data:[]});for(let F=0;F<t[b].columns;F++){let x=h(l).add(b*7+F,"days").format("YYYY-MM-DD"),L=0;(p[x]>=te&&p[x]<P||p[x]>12&&P===12)&&(L=p[x]),t[b].data.push({number:L,date:x})}}}function C(){let _=n.submission_list;for(let f of _)t.forEach(s=>{for(let v of s.data)v.date.slice(2,v.date.length)==h(f.date).format("YY-MM-DD")&&v.number++})}function I(_){let f="#EBEDF0";return _>=12?f="#196127":_>=8?f="#239A3B":_>=4?f="#7BC96F":_>=1?f="#C6E48B":f="#EBEDF0",f}return a(),C(),(_,f)=>(d(),r("div",ne,[o("div",ie,[de,(d(!0),r(V,null,B(t,(s,v)=>(d(),r("div",{class:"column",key:v},[o("div",ce,g(s.title),1),(d(!0),r(V,null,B(s.data,(l,m)=>(d(),r("div",{class:"date-wrapper",key:m,style:E(`background:${I(l.number)};`)},null,4))),128))]))),128))]),re]))}}),fe=S(ue,[["__scopeId","data-v-91b47bab"]]),pe=w({__name:"Tooltip",props:{message:{type:String,required:!0},backgroundColor:{type:String,default:"rgba(0, 0, 0, 0.75)"},textColor:{type:String,default:"white"}},setup(e){const n=$(!1);function t(){n.value=!0}function p(){n.value=!1}return(i,c)=>(d(),r("div",{class:"hover-tip-container",onMouseenter:t,onMouseleave:p},[Y(i.$slots,"default",{},void 0),n.value?(d(),r("div",{key:0,class:"hover-tip-message",style:E({backgroundColor:e.backgroundColor,color:e.textColor})},g(e.message),5)):T("",!0)],32))}}),R=S(pe,[["__scopeId","data-v-5e255a74"]]),me=w({__name:"ScreenMask",props:{center:{type:Boolean,default:!0}},setup(e){return(n,t)=>(d(),r("div",{class:Q({"screen-mask":!0,"screen-mask-center":e.center})},[Y(n.$slots,"default",{},void 0)],2))}}),_e=S(me,[["__scopeId","data-v-fc0756af"]]),ve=w({__name:"PTButton",props:{type:{type:String,default:"default"},disabled:{type:Boolean,default:!1},circle:{type:Boolean,default:!1},plain:{type:Boolean,default:!1}},setup(e){return(n,t)=>(d(),r("button",{class:Q(["pt-button",e.type,{circle:e.circle,[e.type+"-plain"]:e.plain}])},[Y(n.$slots,"default",{},void 0)],2))}}),D=S(ve,[["__scopeId","data-v-7ef97ccc"]]),be={class:"form"},he={class:"form-button-container"},ke=w({__name:"FormTable",props:{submit_text:{type:String,default:"Submit"},cancel_text:{type:String,default:"Cancel"}},emits:["close","submit"],setup(e,{emit:n}){const t=n;function p(){t("close")}function i(){t("submit")}function c(){t("close")}return(a,C)=>(d(),r("div",be,[k(D,{class:"form-close",type:"info",plain:"",circle:"",onClick:p},{default:y(()=>[M("x")]),_:1}),Y(a.$slots,"form",{},void 0),o("div",he,[Y(a.$slots,"button",{},()=>[o("button",{class:"form-button form-button-submit",onClick:i},g(e.submit_text),1),o("button",{class:"form-button form-button-cancel",onClick:c},g(e.cancel_text),1)])])]))}}),ye=S(ke,[["__scopeId","data-v-b3fb6d3e"]]),ge={key:0,for:"input",class:"input-label"},$e=["type","placeholder","value"],we=w({__name:"PTInput",props:{label:{type:String,default:null},placeholder:{type:String,default:""},height:{type:String,default:"40px"},width:{type:String,default:"100%"},modelValue:{type:String,default:""},type:{type:String,default:"text"}},emits:["update:modelValue"],setup(e,{emit:n}){const t=n;return(p,i)=>(d(),r("div",{class:"input",style:E({width:e.width,height:e.height})},[e.label?(d(),r("label",ge,g(e.label),1)):T("",!0),o("input",{id:"input",class:"input-form",type:e.type,placeholder:e.placeholder,onInput:i[0]||(i[0]=c=>t("update:modelValue",c.target.value)),value:e.modelValue},null,40,$e)],4))}}),G=S(we,[["__scopeId","data-v-c77c1144"]]),Se={class:"task-form"},Ce={class:"task-form-item-number"},Me=w({__name:"TaskForm",props:{is_update:{type:Boolean,required:!0}},emits:["close","show"],setup(e,{emit:n}){const t=n;let p=e;const{proxy:i}=ee(),c=new X,a=$({user_id:c.user.id,task_list:[{name:"",describe:""}]});Z(()=>{i.$loading.show(),c.findOne("postgraduate-task","task",{user_id:{$eq:c.user.id}}).then(s=>{s!=null&&(a.value=s)}).finally(()=>{i.$loading.hide()})});function C(){a.value.task_list.push({name:"",describe:""})}function I(s){a.value.task_list.splice(s,1)}function _(){for(let s of a.value.task_list)if(s.name.trim().length==0||s.describe.trim().length==0){alert("name or describe must not be null");return}a.value.date=new Date,i.$loading.show(),p.is_update?c.updateOne("postgraduate-task","task",{_id:{$eq:a.value._id}},a.value).then(s=>{i.$notification.show("Success","update task successfully!"),f()}).finally(()=>{i.$loading.hide()}):c.addOne("postgraduate-task","task",a.value).then(s=>{console.log(s),i.$notification.show("Success","submit task successfully!"),f()}).catch(s=>{console.log(s),i.$notification.show("Error","update task error!")}).finally(()=>{i.$loading.hide()}),c.findOne("postgraduate-task","task",{user_id:{$eq:c.user.id}}).then(s=>{a.value=s})}function f(){t("close")}return(s,v)=>(d(),N(_e,null,{default:y(()=>[k(ye,{onClose:f},{form:y(()=>[o("ol",Se,[(d(!0),r(V,null,B(a.value.task_list,(l,m)=>(d(),r("li",{class:"task-form-item",key:l},[o("span",Ce,g(m+1)+".",1),k(G,{class:"task-form-input",width:"150px",modelValue:l.name,"onUpdate:modelValue":u=>l.name=u,placeholder:"name"},null,8,["modelValue","onUpdate:modelValue"]),k(G,{class:"task-form-input",modelValue:l.describe,"onUpdate:modelValue":u=>l.describe=u,placeholder:"describe"},null,8,["modelValue","onUpdate:modelValue"]),k(D,{type:"danger",plain:"",circle:"",onClick:u=>I(m)},{default:y(()=>[M("-")]),_:2},1032,["onClick"])]))),128))])]),button:y(()=>[k(D,{class:"task-form-button",type:"primary",onClick:_},{default:y(()=>[M("Submit")]),_:1}),k(D,{class:"task-form-button",onClick:C},{default:y(()=>[M("Add")]),_:1})]),_:1})]),_:1}))}}),De=S(Me,[["__scopeId","data-v-e7119db4"]]),Ie=e=>(H("data-v-88d5fbdc"),e=e(),K(),e),xe={class:"profile"},Ye=Ie(()=>o("h2",null,"Profile",-1)),Ve={class:"profile-info"},Be={class:"profile-info-email"},Te={class:"profile-task"},Fe={key:2,class:"profile-task-container"},qe={class:"profile-task-item-name"},Ne={class:"profile-task-item-name-title"},Ee={class:"profile-task-item-descirbe"},Oe={key:3,class:"profile-task-no"},Pe={class:"contribute"},Ae=w({__name:"Profile",setup(e){const{proxy:n}=ee(),t=new X,p=$(!1),i=$(!1),c=q([]),a=$();let C=$(0),I=$(null),_=$(null);Z(()=>{n.$loading.show(),t.findList("postgraduate-task","submission",{user_id:{$eq:t.user.id}}).then(l=>{c.splice(0,c.length),l&&c.push(...l)}).finally(()=>{n.$loading.hide()}),t.count("postgraduate-task","submission",{date:{$gt:new Date(new Date().toLocaleDateString())},user_id:{$eq:t.user.id}}).then(l=>{C.value=l}),t.findOne("postgraduate-task","task",{user_id:{$eq:t.user.id}}).then(l=>{a.value=l,t.findOne("postgraduate-task","task",{user_id:{$eq:t.user.id}}).then(m=>{a.value=m}).catch(m=>{console.log(m)})}).catch(l=>{console.log(l)})});function f(){p.value=!0,i.value=!1}function s(){p.value=!0,i.value=!0}function v(){if(!confirm("is ready to delete task!")){n.$notification.show("Canceled","operate already canceled!");return}n.$loading.show(),t.deleteOne("postgraduate-task","task",{name:{$ne:""}}).then(m=>{n.$notification.show("Success","delete task successfully!"),t.findOne("postgraduate-task","task",{user_id:{$eq:t.user.id}}).then(u=>{a.value=u}).catch(u=>{console.log(u)})}).finally(()=>{n.$loading.hide()})}return(l,m)=>(d(),r("div",xe,[Ye,o("section",Ve,[o("p",Be,g(j(t).user.profile.email),1),k(R,{message:"finished total task number"},{default:y(()=>[o("p",{class:"profile-info-message",ref_key:"total_task_number",ref:I},"total: "+g(c.length),513)]),_:1}),k(R,{message:"today finished task number"},{default:y(()=>[o("p",{class:"profile-info-message",ref_key:"today_task_number",ref:_},"today: "+g(j(C)),513)]),_:1})]),o("section",Te,[a.value?(d(),N(D,{key:0,class:"profile-task-edit",onClick:s},{default:y(()=>[M("Edit")]),_:1})):T("",!0),a.value?(d(),N(D,{key:1,class:"profile-task-delete",type:"danger",onClick:v},{default:y(()=>[M("Delete")]),_:1})):T("",!0),a.value?(d(),r("blockquote",Fe,[(d(!0),r(V,null,B(a.value.task_list,u=>(d(),r("li",{class:"profile-task-item",key:u},[o("div",qe,[o("p",Ne,g(u.name),1)]),o("p",Ee,g(u.describe),1)]))),128))])):(d(),r("blockquote",Oe,[M("no task to finish, to define your "),o("span",{class:"profile-task-no-add",onClick:f},"tasks")]))]),ae(k(De,{onClose:m[0]||(m[0]=()=>p.value=!1),is_update:i.value},null,8,["is_update"]),[[le,p.value]]),o("section",Pe,[k(fe,{submission_list:c},null,8,["submission_list"])])]))}}),We=S(Ae,[["__scopeId","data-v-88d5fbdc"]]);export{We as default};
