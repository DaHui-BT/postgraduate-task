import{d as q,r as J,l as S,o as f,c as b,b as a,F as B,e as O,t as C,s as ee,a as ae,p as W,j as L,_ as N,x as le,n as E,g as j,D as R,y as z,k as F,w as k,i as y,S as te,h as g,u as oe,f as I}from"./index-C2CfGSL5.js";import{h as w,P as Y}from"./PTButton-pXsdmKSD.js";import{P,F as se}from"./PTInput-Bpf2sqQ-.js";const ie=d=>(W("data-v-1a9118bf"),d=d(),L(),d),ne={class:"submission-chart"},re={class:"calendar"},de=ie(()=>a("div",{class:"weeks"},[a("div",{class:"week"},"Mon"),a("div",{class:"week"},"Wed"),a("div",{class:"week"},"Fri")],-1)),ue={class:"title"},ce=ae('<div class="operation" data-v-1a9118bf><div class="slider" data-v-1a9118bf><div class="slider-desc" data-v-1a9118bf>0</div><div style="width:120px;" data-v-1a9118bf></div><div class="slider-desc" data-v-1a9118bf>12+</div></div><div class="legend" data-v-1a9118bf><div class="level-desc" data-v-1a9118bf>less</div><div class="level level-1" data-v-1a9118bf></div><div class="level level-2" data-v-1a9118bf></div><div class="level level-3" data-v-1a9118bf></div><div class="level level-4" data-v-1a9118bf></div><div class="level level-5" data-v-1a9118bf></div><div class="level-desc" data-v-1a9118bf>more</div></div></div>',1),fe=q({__name:"SubmissionChart",props:["submission_list","profile"],setup(d){const e=d,i=J([]),l=J([]),t=S([0,12]),s=["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun","Jul"];function v(){let u=parseInt(w().format("YYYY"))-1+"-"+w().format("MM-DD"),o=w(u).format("YYYY-MM-DD"),p=w(o).weekday()||7,$=p>1?w(o).add(8-p,"days").format("YYYY-MM-DD"):o,_=w().diff(w($),"days")+1,r=7,c=Math.ceil(_/r),h=t.value[0],M=t.value[1];for(let m=0;m<c;m++){let G=m===c-1&&_%r?_%r:r,H=w($).add(m*7,"days").format("M"),K=w($).add(m*7+G,"days").format("M"),Q=m===0?s[parseInt(H)-1]:"",X=!1;parseInt(K)-parseInt(H)&&(X=!0),m&&i[m-1].ifSwitchMonth&&(Q=s[parseInt(K)-1]),i.push({columns:G,title:Q,ifSwitchMonth:X,data:[]});for(let A=0;A<i[m].columns;A++){let T=w($).add(m*7+A,"days").format("YYYY-MM-DD"),Z=0;(l[T]>=h&&l[T]<M||l[T]>12&&M===12)&&(Z=l[T]),i[m].data.push({number:Z,date:T})}}}function V(){let n=e.submission_list;for(let u of n)i.forEach(o=>{for(let p of o.data)p.date.slice(2,p.date.length)==w(u.date).format("YY-MM-DD")&&p.number++})}function D(n){let u="#EBEDF0";return n>=12?u="#196127":n>=8?u="#239A3B":n>=4?u="#7BC96F":n>=1?u="#C6E48B":u="#EBEDF0",u}return v(),V(),(n,u)=>(f(),b("div",ne,[a("div",re,[de,(f(!0),b(B,null,O(i,(o,p)=>(f(),b("div",{class:"column",key:p},[a("div",ue,C(o.title),1),(f(!0),b(B,null,O(o.data,($,_)=>(f(),b("div",{class:"date-wrapper",key:_,style:ee(`background:${D($.number)};`)},null,4))),128))]))),128))]),ce]))}}),_e=N(fe,[["__scopeId","data-v-1a9118bf"]]),me=q({__name:"Tooltip",props:{message:{type:String,required:!0},backgroundColor:{type:String,default:"rgba(0, 0, 0, 0.75)"},textColor:{type:String,default:"white"}},setup(d){const e=S(!1);function i(){e.value=!0}function l(){e.value=!1}return(t,s)=>(f(),b("div",{class:"hover-tip-container",onMouseenter:i,onMouseleave:l},[le(t.$slots,"default",{},void 0),e.value?(f(),b("div",{key:0,class:"hover-tip-message",style:ee({backgroundColor:d.backgroundColor,color:d.textColor})},C(d.message),5)):E("",!0)],32))}}),x=N(me,[["__scopeId","data-v-3e583aa7"]]),ve={class:"task-from"},he={class:"profile-task"},pe={key:2,class:"profile-task-container"},ke={class:"profile-task-item-name"},be={class:"profile-task-item-name-title"},ge={class:"profile-task-item-descirbe"},$e={key:3,class:"profile-task-no"},we={class:"task-form-content"},ye={class:"task-form-item-number"},Se=q({__name:"TaskForm",setup(d){var $,_;const e=($=j())==null?void 0:$.proxy;if(e==null||e==null)throw Error("Server, please try later");const i=new R,l=S(!1),t=S(!1),s=S({user_id:(_=i.user)==null?void 0:_.id,task_list:[]});z(()=>{var r;e.$loading.show(),(r=i.user)!=null&&r.id&&i.findOne("postgraduate-task","task",{user_id:{$eq:i.user.id}}).then(c=>{c!=null&&(s.value=c)}).catch(c=>{e.$notification.show("Error",c.error),console.log(c)}).finally(()=>{e.$loading.hide()})});function v(){s.value.task_list.push({name:"",describe:""})}function V(r){if(s.value.task_list.length==1){alert("at least one task");return}s.value.task_list.splice(r,1)}function D(){for(let r of s.value.task_list)if(r.name.trim().length==0||r.describe.trim().length==0){alert("name or describe must not be null");return}s.value.date=new Date,e==null||e.$loading.show(),t.value?i.updateOne("postgraduate-task","task",{_id:{$eq:s.value._id}},s.value).then(()=>{e==null||e.$notification.show("Success","update task successfully!"),n()}).finally(()=>{e==null||e.$loading.hide()}):i.addOne("postgraduate-task","task",s.value).then(()=>{e==null||e.$notification.show("Success","submit task successfully!"),n()}).catch(r=>{console.log(r),e==null||e.$notification.show("Error",r.error)}).finally(()=>{e==null||e.$loading.hide()})}function n(){l.value=!1}function u(){l.value=!0,t.value=!1,s.value.task_list.push({name:"",describe:""})}function o(){l.value=!0,t.value=!0}function p(){if(!confirm("is ready to delete task!")){e==null||e.$notification.show("Canceled","operate already canceled!");return}e==null||e.$loading.show(),i.deleteOne("postgraduate-task","task",{name:{$ne:""},user_id:{$eq:i.user.id}}).then(()=>{e==null||e.$notification.show("Success","delete task successfully!"),s.value.task_list=[]}).finally(()=>{e==null||e.$loading.hide()})}return(r,c)=>(f(),b("div",ve,[a("section",he,[s.value.task_list.length>0?(f(),F(Y,{key:0,class:"profile-task-edit",onClick:o},{default:k(()=>[y("Edit")]),_:1})):E("",!0),s.value.task_list.length>0?(f(),F(Y,{key:1,class:"profile-task-delete",type:"danger",onClick:p},{default:k(()=>[y("Delete")]),_:1})):E("",!0),s.value.task_list.length>0?(f(),b("blockquote",pe,[(f(!0),b(B,null,O(s.value.task_list,h=>(f(),b("li",{class:"profile-task-item",key:h.name},[a("div",ke,[a("p",be,C(h.name),1)]),a("p",ge,C(h.describe),1)]))),128))])):(f(),b("blockquote",$e,[y(" no task to finish, to define your "),a("span",{class:"profile-task-no-add",onClick:u},"tasks")]))]),l.value?(f(),F(te,{key:0},{default:k(()=>[g(se,{onClose:n},{form:k(()=>[a("ol",we,[(f(!0),b(B,null,O(s.value.task_list,(h,M)=>(f(),b("li",{class:"task-form-item",key:h},[a("span",ye,C(M+1)+".",1),g(P,{class:"task-form-input",width:"150px",modelValue:h.name,"onUpdate:modelValue":m=>h.name=m,placeholder:"name"},null,8,["modelValue","onUpdate:modelValue"]),g(P,{class:"task-form-input",modelValue:h.describe,"onUpdate:modelValue":m=>h.describe=m,placeholder:"describe"},null,8,["modelValue","onUpdate:modelValue"]),g(Y,{type:"danger",plain:"",circle:"",onClick:m=>V(M)},{default:k(()=>[y("-")]),_:2},1032,["onClick"])]))),128))])]),button:k(()=>[g(Y,{class:"task-form-button",type:"primary",onClick:D},{default:k(()=>[y("Submit")]),_:1}),g(Y,{class:"task-form-button",onClick:v},{default:k(()=>[y("Add")]),_:1})]),_:1})]),_:1})):E("",!0)]))}}),Ce=N(Se,[["__scopeId","data-v-6774e8e2"]]),De=d=>(W("data-v-483fd72d"),d=d(),L(),d),Me=De(()=>a("br",null,null,-1)),Ye=q({__name:"UserInfoForm",props:["user_info"],emits:["close"],setup(d,{emit:e}){var n;const i=e,l=d,t=(n=j())==null?void 0:n.proxy;if(t==null||t==null)throw Error("Server, please try later");const s=new R,v=S(l.user_info);z(()=>{var u;t.$loading.show(),(u=s.user)!=null&&u.id&&s.findOne("postgraduate-task","user",{_id:{$eq:s.user.id}}).then(o=>{o!=null&&(v.value=o)}).catch(o=>{t.$notification.show("Error",o.error),console.log(o)}).finally(()=>{t.$loading.hide()})});function V(){if(v.value.username.trim().length==0){alert("username must not be null");return}v.value.update_date=new Date,t==null||t.$loading.show(),s.updateOne("postgraduate-task","user",{_id:{$eq:v.value._id}},v.value).then(()=>{t==null||t.$notification.show("Success","update user information successfully!"),D(v.value)}).finally(()=>{t==null||t.$loading.hide()})}function D(u){i("close",u)}return(u,o)=>(f(),F(te,null,{default:k(()=>[g(se,{onClose:D},{form:k(()=>[g(P,{class:"task-form-input",modelValue:v.value.username,"onUpdate:modelValue":o[0]||(o[0]=p=>v.value.username=p),placeholder:"username"},null,8,["modelValue"]),Me,g(P,{class:"task-form-input",modelValue:v.value.describe,"onUpdate:modelValue":o[1]||(o[1]=p=>v.value.describe=p),placeholder:"describe"},null,8,["modelValue"])]),button:k(()=>[g(Y,{class:"task-form-button",type:"primary",onClick:V},{default:k(()=>[y("Submit")]),_:1})]),_:1})]),_:1}))}}),Ve=N(Ye,[["__scopeId","data-v-483fd72d"]]),U=d=>(W("data-v-573f625c"),d=d(),L(),d),Ie={class:"profile"},Ee={class:"profile-header"},Fe=U(()=>a("h2",{class:"profile-header-title"},"Profile",-1)),Te={class:"profile-header-container"},qe={class:"profile-info"},Ne={class:"profile-info-username"},Be=U(()=>a("span",{class:"profile-info-title"},"Username:",-1)),Oe={class:"profile-info-email"},Pe=U(()=>a("span",{class:"profile-info-title"},"Email:",-1)),Ue={class:"profile-info-describe"},Ae=U(()=>a("br",null,null,-1)),Je={class:"contribute"},We=q({__name:"Profile",setup(d){var $;const e=($=j())==null?void 0:$.proxy;if(e==null||e==null)throw Error("Server, please try later");const i=oe(),l=new R,t=J([]);let s=S(!1),v=S(0),V=S(null),D=S(null),n=S({username:"",email:"",describe:""});z(()=>{var _,r;if(((_=l.user)==null?void 0:_.id)==null||((r=l.user)==null?void 0:r.id)==null){alert("Please login first"),i.push({path:"/login"});return}l.findOne("postgraduate-task","user",{_id:{$eq:l.user.id}}).then(c=>{var h,M;c==null&&l.addOne("postgraduate-task","user",{_id:(h=l.user)==null?void 0:h.id,username:"YaYa",email:(M=l.user)==null?void 0:M.profile.email,describe:"Nothing left",register_date:new Date,update_date:new Date,status:0}).catch(m=>{e==null||e.$notification.show("Error",m.error)}),c!=null&&(n.value=c)}),e==null||e.$loading.show(),l.findList("postgraduate-task","submission",{user_id:{$eq:l.user.id}}).then(c=>{t.splice(0,t.length),c&&t.push(...c)}).finally(()=>{e==null||e.$loading.hide()}),l.count("postgraduate-task","submission",{date:{$gte:new Date(w().format("YYYY-MM-DD"))},user_id:{$eq:l.user.id}}).then(c=>{v.value=c})});function u(){s.value=!0}function o(_){console.log(_),_&&(n.value=_),s.value=!1}function p(){var _;(_=l.user)==null||_.logOut(),localStorage.clear(),i.push({path:"/"})}return(_,r)=>{var c,h;return f(),b("div",Ie,[a("section",Ee,[Fe,a("div",Te,[g(Y,{class:"profile-header-edit",type:"primary",onClick:u},{default:k(()=>[y("Edit")]),_:1}),g(Y,{class:"profile-header-logout",type:"warning",onClick:p},{default:k(()=>[y("Logout")]),_:1})])]),a("section",qe,[a("p",Ne,[Be,y(" "+C((c=I(n))==null?void 0:c.username),1)]),a("p",Oe,[Pe,y(" "+C((h=I(n))==null?void 0:h.email),1)]),g(x,{message:"finished total task number"},{default:k(()=>[a("p",{class:"profile-info-message",ref_key:"total_task_number",ref:V},"total: "+C(t.length),513)]),_:1}),g(x,{message:"today finished task number"},{default:k(()=>[a("p",{class:"profile-info-message",ref_key:"today_task_number",ref:D},"today: "+C(I(v)),513)]),_:1})]),a("blockquote",Ue,"Describe: "+C(I(n).describe),1),Ae,g(Ce),I(s)?(f(),F(Ve,{key:0,onClose:o,user_info:I(n)},null,8,["user_info"])):E("",!0),a("section",Je,[t.length>0?(f(),F(_e,{key:0,submission_list:t},null,8,["submission_list"])):E("",!0)])])}}}),ze=N(We,[["__scopeId","data-v-573f625c"]]);export{ze as default};
