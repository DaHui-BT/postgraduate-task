import{P as K,h as w,a as O,F as Q}from"./PTInput-BfTX7nd8.js";import{d as V,o as t,b as N,w as S,e as l,S as H,_ as F,r as I,c as o,t as d,F as x,f as B,g as $,D as R,h as W,i as C,j as k,k as Z,u as ee,n as se,l as j,p as te,m as le,q as ae}from"./index-DXRoSsfY.js";const ie={class:"image-block"},oe=["src"],ne=V({__name:"ImageBlock",props:["image_url"],emits:["close"],setup(r,{emit:g}){const h=r,c=g;function u(){c("close")}return(y,b)=>(t(),N(H,null,{default:S(()=>[l("div",ie,[l("div",{class:"close",onClick:u},"X"),l("img",{src:h.image_url,alt:""},null,8,oe)])]),_:1}))}}),ce=F(ne,[["__scopeId","data-v-26ccb747"]]),ue={class:"pt-upload"},de={class:"pt-upload-button",for:"upload"},re=["accept"],me={key:0,class:"pt-upload-file-container"},_e={key:1,class:"pt-upload-file-message"},fe=V({__name:"PTUpload",props:{multiple:{type:Boolean,default:!1},accept:{type:String,default:""},text:{type:String,default:"Upload"},message:{type:String,default:"each file size must under 5MB"}},emits:["on-change"],setup(r,{emit:g}){const h=g,c=I([]);function u(y){for(let b of y)if(b.size>5*1024*1024*8){alert("file size over 5MB");return}c.push(...y),h("on-change",c)}return(y,b)=>(t(),o("div",ue,[l("label",de,d(r.text),1),l("input",{class:"pt-upload-file",id:"upload",type:"file",multiple:"",accept:r.accept,onChange:b[0]||(b[0]=f=>u(f.target.files))},null,40,re),c.length>0?(t(),o("ul",me,[(t(!0),o(x,null,B(c,f=>(t(),o("li",{class:"pt-upload-file-item",key:f},d(f.name),1))),128))])):(t(),o("p",_e,d(r.message),1))]))}}),pe=F(fe,[["__scopeId","data-v-9a4f7612"]]),ge=r=>(te("data-v-ac12d048"),r=r(),le(),r),he={class:"submission"},be=ge(()=>l("h1",null,"This is the submission page",-1)),ye={key:2,class:"submission-content"},ve={class:"submission-collapse-container"},ke={class:"submission-collapse-func"},we={class:"submission-collapse-func-item"},$e={class:"submission-collapse-func-item"},Ce={class:"submission-collapse-func-item"},Se={class:"submission-func"},Ie=["onClick"],xe={class:"submission-func-container"},Be={key:0,class:"submission-file"},Me=["onClick"],De={class:"submission-date"},Ne={class:"submission-message"},Ve={key:0,class:"submission-line"},Fe={key:3,class:"empty"},Te=V({__name:"Submission",setup(r){const g=$(!1),h=$(!1),c=$(!1),{proxy:u}=ae(),y=["submit","checked","awarded","failed"],b=["#895ef9fc","#41d6ba","#3ddf58","#f95e85fc"],f=$(null),p=new R,m=I([]),v=I([]),n=I({user_id:p.user.id,file_id_list:[],file_name_list:[],status:0});function L(){h.value=!1}async function M(){h.value=!0,await p.findList("postgraduate-task","submission").then(a=>{v.splice(0,v.length),m.splice(0,m.length),a!=null&&v.push(...a),v.sort((s,e)=>e.date.getTime()-s.date.getTime()),v.forEach(s=>{m.length==0||m.filter(e=>e.id==w(s.date).format("YY-MM-DD")).length==0?m.push({id:w(s.date).format("YY-MM-DD"),task_list:[s]}):m.map(e=>{if(e.id==w(s.date).format("YY-MM-DD")){e.task_list.push(s);return}})})}).catch(a=>{console.log(a)}).finally(()=>{h.value=!1})}W(async()=>{await M()});function q(a){a.target.parentNode.nextElementSibling.style.display=="none"?a.target.parentNode.nextElementSibling.style.display="block":a.target.parentNode.nextElementSibling.style.display="none"}function D(a,s){let e=0;for(let _ of a)_.status>=s&&e++;return e}function A(a){u.$loading.show(),f.value=null,p.getImageUrl("postgraduate-task","files",a).then(s=>{f.value=s,u.$loading.hide(),g.value=!0})}function X(){f.value=null,g.value=!1,L()}function T(){c.value=!c.value,c.value==!1&&(console.log(n),n.message==null||n.title==null||n.message.trim().length==0||n.title.trim().length==0?alert("Nothing to submit! The form should be completed!"):(n.date=new Date,p.addOne("postgraduate-task","submission",n).then(()=>{u.$notification.show("Success","add submission successfully!"),M()})))}async function G(a){if(confirm(`is ready to delete ${a.title}!`)){if(prompt("input your delete token")!="delete")return;u.$loading.show(),await p.findOne("postgraduate-task","submission",{_id:a._id}).then(async _=>{var i;((i=_.file_id_list)==null?void 0:i.length)>0&&await p.deleteMany("postgraduate-task","files",{_id:{$in:_.file_id_list}}),await p.deleteOne("postgraduate-task","submission",{_id:_._id}),M()}).finally(()=>{u.$loading.hide()})}else u.$notification.show("Cancel","operate already canceled!")}function J(a){u.$loading.show();for(let s of a)p.uploadFile("postgraduate-task","files",s).then(e=>{var _,i;console.log(e),(_=n.file_id_list)==null||_.push(e.insertedId),(i=n.file_name_list)==null||i.push(e.file_name)}).catch(e=>{console.log(e)}).finally(()=>{u.$loading.hide()})}return(a,s)=>(t(),o("div",he,[g.value?(t(),N(ce,{key:0,image_url:f.value,onClose:X},null,8,["image_url"])):C("",!0),be,k(K,{class:"submit-button",type:"primary",onClick:T},{default:S(()=>[Z("submit")]),_:1}),c.value?(t(),N(H,{key:1},{default:S(()=>[k(Q,{onClose:s[2]||(s[2]=()=>c.value=!1),onSubmit:T},{form:S(()=>[k(O,{placeholder:"title",modelValue:n.title,"onUpdate:modelValue":s[0]||(s[0]=e=>n.title=e)},null,8,["modelValue"]),k(pe,{onOnChange:J,accept:".png, .jpg, .jpeg"}),k(O,{placeholder:"message",modelValue:n.message,"onUpdate:modelValue":s[1]||(s[1]=e=>n.message=e)},null,8,["modelValue"])]),_:1})]),_:1})):C("",!0),(m==null?void 0:m.length)>0?(t(),o("ul",ye,[(t(!0),o(x,null,B(m,(e,_)=>(t(),o("li",{class:"submission-item",key:e.id},[l("div",ve,[l("div",{class:"submission-collapse",onClick:q},d(e.id),1),l("div",ke,[l("span",we,"Submitted: "+d(D(e.task_list,0)),1),l("span",$e,"Checked: "+d(D(e.task_list,1)),1),l("span",Ce,"Awarded: "+d(D(e.task_list,2)),1)])]),l("div",{class:"submission-item-container",style:j({display:_==0?"display":"none"})},[(t(!0),o(x,null,B(e.task_list,(i,U)=>{var Y,z;return t(),o("div",{class:"submission-item-container-content",key:U},[l("div",Se,[l("div",{class:"submission-title",onClick:E=>G(i)},d(i.title),9,Ie),l("div",xe,[((Y=i.file_id_list)==null?void 0:Y.length)>0?(t(),o("div",Be,[(t(!0),o(x,null,B(i.file_name_list,(E,P)=>(t(),o("div",{class:"submission-file-item",key:P,onClick:Ue=>A(i.file_id_list[P])},d(E),9,Me))),128))])):C("",!0),l("div",De,d(ee(w)(i.date).format("HH:mm:ss")),1),l("div",{class:se({"submission-status":!0,"submission-status-error":i.status==3}),style:j({backgroundColor:b[i.status]})},d(y[i.status]),7)])]),l("div",Ne,d(i.message),1),U!=((z=e.task_list)==null?void 0:z.length)-1?(t(),o("hr",Ve)):C("",!0)])}),128))],4)]))),128))])):(t(),o("div",Fe," Nothing to show! "))]))}}),Ee=F(Te,[["__scopeId","data-v-ac12d048"]]);export{Ee as default};
