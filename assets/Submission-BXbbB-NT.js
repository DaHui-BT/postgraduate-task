import{h as $}from"./moment-C5S46NFB.js";import{d as M,D as O,r as y,o,c,b as e,w as L,v as U,e as w,p as X,f as A,_ as N,g as j,h as K,i as z,j as P,F as I,k as x,t as f,u as Q,n as R,l as H,L as W}from"./index-Bm0dTqqU.js";const Z=d=>(X("data-v-61e11412"),d=d(),A(),d),ee={key:0,class:"submit-table"},te={class:"submit-container"},se=Z(()=>e("h2",{class:"submit-container-title"},"Submit",-1)),ie=M({__name:"SubmitTable",props:["is_submit_form_show"],emits:["submit","start_loading","stop_loading","hide_submit_form"],setup(d,{emit:b}){const n=b,_=new O,a=y({title:"",message:"",status:0,file_id_list:[],file_name_list:[]});function S(p){let i=p.target.files;if(i==null||i==null){alert("No files upload");return}for(let m of i)if(m.size>500*1024*1024){alert("upload file over than 500M!");return}n("start_loading");for(let m of i)new FormData().append("file",m),_.uploadFile("postgraduate-task","files",m).then(h=>{var D,k;(D=a.value.file_id_list)==null||D.push(h.insertedId),(k=a.value.file_name_list)==null||k.push(h.file_name)}).catch(h=>{console.log(h)}).finally(()=>{n("stop_loading")})}function g(){n("submit",a.value),a.value={},a.value.status=0,a.value.file_id_list=[],a.value.file_name_list=[]}function r(){n("hide_submit_form")}return(p,i)=>d.is_submit_form_show?(o(),c("div",ee,[e("div",te,[e("div",{class:"submit-container-close",onClick:r},"X"),se,L(e("input",{class:"submit-container-item submit-container-item-title",type:"text",placeholder:"title","onUpdate:modelValue":i[0]||(i[0]=m=>a.value.title=m)},null,512),[[U,a.value.title]]),e("input",{class:"submit-container-item-file",id:"input-file",type:"file",multiple:"",accept:".png, .jpg, .jpeg",name:"Upload",onChange:S},null,32),L(e("textarea",{class:"submit-container-item submit-container-item-textarea",placeholder:"describe",name:"",id:"",rows:"5","onUpdate:modelValue":i[1]||(i[1]=m=>a.value.message=m)},null,512),[[U,a.value.message]]),e("button",{class:"submit-container-item submit-container-submit",onClick:g},"Submit")])])):w("",!0)}}),ae=N(ie,[["__scopeId","data-v-61e11412"]]),le={class:"image-block"},oe=["src"],ne=M({__name:"ImageBlock",props:["image_url"],emits:["close"],setup(d,{emit:b}){const n=d,_=b;function a(){_("close")}return(S,g)=>(o(),c("div",le,[e("div",{class:"close",onClick:a},"X"),e("img",{src:n.image_url,alt:""},null,8,oe)]))}}),ue=N(ne,[["__scopeId","data-v-7e14827f"]]),ce=d=>(X("data-v-945c5880"),d=d(),A(),d),de={class:"submission"},re=ce(()=>e("h1",null,"This is the submission page",-1)),me={key:2,class:"submission-content"},_e={class:"submission-collapse-container"},fe={class:"submission-collapse-func"},pe={class:"submission-collapse-func-item"},he={class:"submission-collapse-func-item"},be={class:"submission-collapse-func-item"},ge={class:"submission-func"},ve=["onClick"],ke={class:"submission-func-container"},ye={key:0,class:"submission-file"},we=["onClick"],Se={class:"submission-date"},Ce={class:"submission-message"},De={key:0,class:"submission-line"},$e={key:3,class:"empty"},Ie=M({__name:"Submission",setup(d){const b=y(!1),n=y(!1),_=y(!1),a=["submit","checked","awarded","failed"],S=["#895ef9fc","#41d6ba","#3ddf58","#f95e85fc"],g=y(null),r=j([]),p=j([]),i=new O;function m(){n.value=!0}function C(){n.value=!1}async function h(){n.value=!0,await i.findList("postgraduate-task","submission").then(t=>{p.splice(0,p.length),r.splice(0,r.length),t!=null&&p.push(...t),p.sort((l,s)=>s.date.getTime()-l.date.getTime()),p.forEach(l=>{r.length==0||r.filter(s=>s.id==$(l.date).format("YY-MM-DD")).length==0?r.push({id:$(l.date).format("YY-MM-DD"),task_list:[l]}):r.map(s=>{if(s.id==$(l.date).format("YY-MM-DD")){s.task_list.push(l);return}})})}).catch(t=>{console.log(t)}).finally(()=>{n.value=!1})}K(async()=>{await h()});function D(t){t.target.parentNode.nextElementSibling.style.display=="none"?t.target.parentNode.nextElementSibling.style.display="block":t.target.parentNode.nextElementSibling.style.display="none"}function k(t,l){let s=0;for(let v of t)v.status>=l&&s++;return s}function q(t){b.value=!0,m(),g.value=null,i.getImageUrl("postgraduate-task","files",t).then(l=>{g.value=l,C()})}function G(){g.value=null,b.value=!1,C()}function B(t){_.value=!_.value,_.value==!1&&(t.message==null||t.title==null||t.message.trim().length==0||t.title.trim().length==0?alert("Nothing to submit! The form should be completed!"):(t.date=new Date,i.addOne("postgraduate-task","submission",t),h()))}async function J(t){if(confirm(`is ready to delete ${t.title}!`)){if(prompt("input your delete token")!="delete")return;n.value=!0,await i.findOne("postgraduate-task","submission",{_id:t._id}).then(async v=>{var u;((u=v.file_id_list)==null?void 0:u.length)>0&&await i.deleteMany("postgraduate-task","files",{_id:{$in:v.file_id_list}}),await i.deleteOne("postgraduate-task","submission",{_id:v._id}),h()}).finally(()=>{n.value=!1})}else alert("operate already canceled!")}return(t,l)=>(o(),c("div",de,[n.value?(o(),z(W,{key:0})):w("",!0),b.value?(o(),z(ue,{key:1,image_url:g.value,onClose:G},null,8,["image_url"])):w("",!0),re,e("div",{class:"submit-button",onClick:B},"submit"),P(ae,{is_submit_form_show:_.value,onSubmit:B,onStart_loading:m,onStop_loading:C,onHide_submit_form:l[0]||(l[0]=s=>_.value=!1)},null,8,["is_submit_form_show"]),(r==null?void 0:r.length)>0?(o(),c("ul",me,[(o(!0),c(I,null,x(r,(s,v)=>(o(),c("li",{class:"submission-item",key:s.id},[e("div",_e,[e("div",{class:"submission-collapse",onClick:D},f(s.id),1),e("div",fe,[e("span",pe,"Submitted: "+f(k(s.task_list,0)),1),e("span",he,"Checked: "+f(k(s.task_list,1)),1),e("span",be,"Awarded: "+f(k(s.task_list,2)),1)])]),e("div",{class:"submission-item-container",style:H({display:v==0?"display":"none"})},[(o(!0),c(I,null,x(s.task_list,(u,T)=>{var Y,E;return o(),c("div",{class:"submission-item-container-content",key:T},[e("div",ge,[e("div",{class:"submission-title",onClick:V=>J(u)},f(u.title),9,ve),e("div",ke,[((Y=u.file_id_list)==null?void 0:Y.length)>0?(o(),c("div",ye,[(o(!0),c(I,null,x(u.file_name_list,(V,F)=>(o(),c("div",{class:"submission-file-item",key:F,onClick:xe=>q(u.file_id_list[F])},f(V),9,we))),128))])):w("",!0),e("div",Se,f(Q($)(u.date).format("HH:mm:ss")),1),e("div",{class:R({"submission-status":!0,"submission-status-error":u.status==3}),style:H({backgroundColor:S[u.status]})},f(a[u.status]),7)])]),e("div",Ce,f(u.message),1),T!=((E=s.task_list)==null?void 0:E.length)-1?(o(),c("hr",De)):w("",!0)])}),128))],4)]))),128))])):(o(),c("div",$e," Nothing to show! "))]))}}),Be=N(Ie,[["__scopeId","data-v-945c5880"]]);export{Be as default};
