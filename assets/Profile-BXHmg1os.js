import{d as q,r as A,j as y,o as f,c as b,b as l,F as B,e as O,t as S,s as x,a as ae,p as J,h as W,_ as N,x as le,l as E,g as L,D as j,y as R,i as F,w as k,n as C,S as ee,m as g,u as oe,f as I}from"./index-uNL48YLD.js";import{h as w}from"./moment-C5S46NFB.js";import{P as Y,a as U,F as te}from"./PTInput-BV00OGNE.js";const ie=d=>(J("data-v-1a9118bf"),d=d(),W(),d),ne={class:"submission-chart"},re={class:"calendar"},de=ie(()=>l("div",{class:"weeks"},[l("div",{class:"week"},"Mon"),l("div",{class:"week"},"Wed"),l("div",{class:"week"},"Fri")],-1)),ue={class:"title"},ce=ae('<div class="operation" data-v-1a9118bf><div class="slider" data-v-1a9118bf><div class="slider-desc" data-v-1a9118bf>0</div><div style="width:120px;" data-v-1a9118bf></div><div class="slider-desc" data-v-1a9118bf>12+</div></div><div class="legend" data-v-1a9118bf><div class="level-desc" data-v-1a9118bf>less</div><div class="level level-1" data-v-1a9118bf></div><div class="level level-2" data-v-1a9118bf></div><div class="level level-3" data-v-1a9118bf></div><div class="level level-4" data-v-1a9118bf></div><div class="level level-5" data-v-1a9118bf></div><div class="level-desc" data-v-1a9118bf>more</div></div></div>',1),fe=q({__name:"SubmissionChart",props:["submission_list","profile"],setup(d){const e=d,i=A([]),a=A([]),t=y([0,12]),s=["Jul","Aug","Sep","Oct","Nov","Dec","Jan","Feb","Mar","Apr","May","Jun","Jul"];function v(){let u=parseInt(w().format("YYYY"))-1+"-"+w().format("MM-DD"),o=w(u).format("YYYY-MM-DD"),p=w(o).weekday()||7,$=p>1?w(o).add(8-p,"days").format("YYYY-MM-DD"):o,_=w().diff(w($),"days")+1,r=7,c=Math.ceil(_/r),h=t.value[0],M=t.value[1];for(let m=0;m<c;m++){let z=m===c-1&&_%r?_%r:r,G=w($).add(m*7,"days").format("M"),H=w($).add(m*7+z,"days").format("M"),K=m===0?s[parseInt(G)-1]:"",Q=!1;parseInt(H)-parseInt(G)&&(Q=!0),m&&i[m-1].ifSwitchMonth&&(K=s[parseInt(H)-1]),i.push({columns:z,title:K,ifSwitchMonth:Q,data:[]});for(let P=0;P<i[m].columns;P++){let T=w($).add(m*7+P,"days").format("YYYY-MM-DD"),X=0;(a[T]>=h&&a[T]<M||a[T]>12&&M===12)&&(X=a[T]),i[m].data.push({number:X,date:T})}}}function V(){let n=e.submission_list;for(let u of n)i.forEach(o=>{for(let p of o.data)p.date.slice(2,p.date.length)==w(u.date).format("YY-MM-DD")&&p.number++})}function D(n){let u="#EBEDF0";return n>=12?u="#196127":n>=8?u="#239A3B":n>=4?u="#7BC96F":n>=1?u="#C6E48B":u="#EBEDF0",u}return v(),V(),(n,u)=>(f(),b("div",ne,[l("div",re,[de,(f(!0),b(B,null,O(i,(o,p)=>(f(),b("div",{class:"column",key:p},[l("div",ue,S(o.title),1),(f(!0),b(B,null,O(o.data,($,_)=>(f(),b("div",{class:"date-wrapper",key:_,style:x(`background:${D($.number)};`)},null,4))),128))]))),128))]),ce]))}}),_e=N(fe,[["__scopeId","data-v-1a9118bf"]]),me=q({__name:"Tooltip",props:{message:{type:String,required:!0},backgroundColor:{type:String,default:"rgba(0, 0, 0, 0.75)"},textColor:{type:String,default:"white"}},setup(d){const e=y(!1);function i(){e.value=!0}function a(){e.value=!1}return(t,s)=>(f(),b("div",{class:"hover-tip-container",onMouseenter:i,onMouseleave:a},[le(t.$slots,"default",{},void 0),e.value?(f(),b("div",{key:0,class:"hover-tip-message",style:x({backgroundColor:d.backgroundColor,color:d.textColor})},S(d.message),5)):E("",!0)],32))}}),Z=N(me,[["__scopeId","data-v-21420a6c"]]),ve={class:"task-from"},he={class:"profile-task"},pe={key:2,class:"profile-task-container"},ke={class:"profile-task-item-name"},be={class:"profile-task-item-name-title"},ge={class:"profile-task-item-descirbe"},$e={key:3,class:"profile-task-no"},we={class:"task-form-content"},ye={class:"task-form-item-number"},Se=q({__name:"TaskForm",setup(d){var $,_;const e=($=L())==null?void 0:$.proxy;if(e==null||e==null)throw Error("Server, please try later");const i=new j,a=y(!1),t=y(!1),s=y({user_id:(_=i.user)==null?void 0:_.id,task_list:[]});R(()=>{var r;e.$loading.show(),(r=i.user)!=null&&r.id&&i.findOne("postgraduate-task","task",{user_id:{$eq:i.user.id}}).then(c=>{c!=null&&(s.value=c)}).catch(c=>{e.$notification.show("Error",c.error),console.log(c)}).finally(()=>{e.$loading.hide()})});function v(){s.value.task_list.push({name:"",describe:""})}function V(r){if(s.value.task_list.length==1){alert("at least one task");return}s.value.task_list.splice(r,1)}function D(){for(let r of s.value.task_list)if(r.name.trim().length==0||r.describe.trim().length==0){alert("name or describe must not be null");return}s.value.date=new Date,e==null||e.$loading.show(),t.value?i.updateOne("postgraduate-task","task",{_id:{$eq:s.value._id}},s.value).then(()=>{e==null||e.$notification.show("Success","update task successfully!"),n()}).finally(()=>{e==null||e.$loading.hide()}):i.addOne("postgraduate-task","task",s.value).then(()=>{e==null||e.$notification.show("Success","submit task successfully!"),n()}).catch(r=>{console.log(r),e==null||e.$notification.show("Error",r.error)}).finally(()=>{e==null||e.$loading.hide()})}function n(){a.value=!1}function u(){a.value=!0,t.value=!1,s.value.task_list.push({name:"",describe:""})}function o(){a.value=!0,t.value=!0}function p(){if(!confirm("is ready to delete task!")){e==null||e.$notification.show("Canceled","operate already canceled!");return}e==null||e.$loading.show(),i.deleteOne("postgraduate-task","task",{name:{$ne:""},user_id:{$eq:i.user.id}}).then(()=>{e==null||e.$notification.show("Success","delete task successfully!"),s.value.task_list=[]}).finally(()=>{e==null||e.$loading.hide()})}return(r,c)=>(f(),b("div",ve,[l("section",he,[s.value.task_list.length>0?(f(),F(Y,{key:0,class:"profile-task-edit",onClick:o},{default:k(()=>[C("Edit")]),_:1})):E("",!0),s.value.task_list.length>0?(f(),F(Y,{key:1,class:"profile-task-delete",type:"danger",onClick:p},{default:k(()=>[C("Delete")]),_:1})):E("",!0),s.value.task_list.length>0?(f(),b("blockquote",pe,[(f(!0),b(B,null,O(s.value.task_list,h=>(f(),b("li",{class:"profile-task-item",key:h.name},[l("div",ke,[l("p",be,S(h.name),1)]),l("p",ge,S(h.describe),1)]))),128))])):(f(),b("blockquote",$e,[C(" no task to finish, to define your "),l("span",{class:"profile-task-no-add",onClick:u},"tasks")]))]),a.value?(f(),F(ee,{key:0},{default:k(()=>[g(te,{onClose:n},{form:k(()=>[l("ol",we,[(f(!0),b(B,null,O(s.value.task_list,(h,M)=>(f(),b("li",{class:"task-form-item",key:h},[l("span",ye,S(M+1)+".",1),g(U,{class:"task-form-input",width:"150px",modelValue:h.name,"onUpdate:modelValue":m=>h.name=m,placeholder:"name"},null,8,["modelValue","onUpdate:modelValue"]),g(U,{class:"task-form-input",modelValue:h.describe,"onUpdate:modelValue":m=>h.describe=m,placeholder:"describe"},null,8,["modelValue","onUpdate:modelValue"]),g(Y,{type:"danger",plain:"",circle:"",onClick:m=>V(M)},{default:k(()=>[C("-")]),_:2},1032,["onClick"])]))),128))])]),button:k(()=>[g(Y,{class:"task-form-button",type:"primary",onClick:D},{default:k(()=>[C("Submit")]),_:1}),g(Y,{class:"task-form-button",onClick:v},{default:k(()=>[C("Add")]),_:1})]),_:1})]),_:1})):E("",!0)]))}}),Ce=N(Se,[["__scopeId","data-v-6774e8e2"]]),De=d=>(J("data-v-483fd72d"),d=d(),W(),d),Me=De(()=>l("br",null,null,-1)),Ye=q({__name:"UserInfoForm",props:["user_info"],emits:["close"],setup(d,{emit:e}){var n;const i=e,a=d,t=(n=L())==null?void 0:n.proxy;if(t==null||t==null)throw Error("Server, please try later");const s=new j,v=y(a.user_info);R(()=>{var u;t.$loading.show(),(u=s.user)!=null&&u.id&&s.findOne("postgraduate-task","user",{_id:{$eq:s.user.id}}).then(o=>{o!=null&&(v.value=o)}).catch(o=>{t.$notification.show("Error",o.error),console.log(o)}).finally(()=>{t.$loading.hide()})});function V(){if(v.value.username.trim().length==0){alert("username must not be null");return}v.value.update_date=new Date,t==null||t.$loading.show(),s.updateOne("postgraduate-task","user",{_id:{$eq:v.value._id}},v.value).then(()=>{t==null||t.$notification.show("Success","update user information successfully!"),D(v.value)}).finally(()=>{t==null||t.$loading.hide()})}function D(u){i("close",u)}return(u,o)=>(f(),F(ee,null,{default:k(()=>[g(te,{onClose:D},{form:k(()=>[g(U,{class:"task-form-input",modelValue:v.value.username,"onUpdate:modelValue":o[0]||(o[0]=p=>v.value.username=p),placeholder:"username"},null,8,["modelValue"]),Me,g(U,{class:"task-form-input",modelValue:v.value.describe,"onUpdate:modelValue":o[1]||(o[1]=p=>v.value.describe=p),placeholder:"describe"},null,8,["modelValue"])]),button:k(()=>[g(Y,{class:"task-form-button",type:"primary",onClick:V},{default:k(()=>[C("Submit")]),_:1})]),_:1})]),_:1}))}}),Ve=N(Ye,[["__scopeId","data-v-483fd72d"]]),se=d=>(J("data-v-68941ff4"),d=d(),W(),d),Ie={class:"profile"},Ee={class:"profile-header"},Fe=se(()=>l("h2",{class:"profile-header-title"},"Profile",-1)),Te={class:"profile-header-container"},qe={class:"profile-info"},Ne={class:"profile-info-username"},Be={class:"profile-info-email"},Oe={class:"profile-info-describe"},Ue=se(()=>l("br",null,null,-1)),Pe={class:"contribute"},Ae=q({__name:"Profile",setup(d){var $;const e=($=L())==null?void 0:$.proxy;if(e==null||e==null)throw Error("Server, please try later");const i=oe(),a=new j,t=A([]);let s=y(!1),v=y(0),V=y(null),D=y(null),n=y({username:"",email:"",describe:""});R(()=>{var _,r;if(((_=a.user)==null?void 0:_.id)==null||((r=a.user)==null?void 0:r.id)==null){alert("Please login first"),i.push({path:"/login"});return}a.findOne("postgraduate-task","user",{_id:{$eq:a.user.id}}).then(c=>{var h,M;c==null&&a.addOne("postgraduate-task","user",{_id:(h=a.user)==null?void 0:h.id,username:"YaYa",email:(M=a.user)==null?void 0:M.profile.email,describe:"Nothing left",register_date:new Date,update_date:new Date,status:0}).catch(m=>{e==null||e.$notification.show("Error",m.error)}),c!=null&&(n.value=c)}),e==null||e.$loading.show(),a.findList("postgraduate-task","submission",{user_id:{$eq:a.user.id}}).then(c=>{t.splice(0,t.length),c&&t.push(...c)}).finally(()=>{e==null||e.$loading.hide()}),a.count("postgraduate-task","submission",{date:{$gte:new Date(w().format("YYYY-MM-DD"))},user_id:{$eq:a.user.id}}).then(c=>{v.value=c})});function u(){s.value=!0}function o(_){console.log(_),_&&(n.value=_),s.value=!1}function p(){var _;(_=a.user)==null||_.logOut(),localStorage.clear(),i.push({path:"/"})}return(_,r)=>{var c,h;return f(),b("div",Ie,[l("section",Ee,[Fe,l("div",Te,[g(Y,{class:"profile-header-edit",type:"primary",onClick:u},{default:k(()=>[C("Edit")]),_:1}),g(Y,{class:"profile-header-logout",type:"warning",onClick:p},{default:k(()=>[C("Logout")]),_:1})])]),l("section",qe,[l("p",Ne,"Username: "+S((c=I(n))==null?void 0:c.username),1),l("p",Be,"Email: "+S((h=I(n))==null?void 0:h.email),1),g(Z,{message:"finished total task number"},{default:k(()=>[l("p",{class:"profile-info-message",ref_key:"total_task_number",ref:V},"total: "+S(t.length),513)]),_:1}),g(Z,{message:"today finished task number"},{default:k(()=>[l("p",{class:"profile-info-message",ref_key:"today_task_number",ref:D},"today: "+S(I(v)),513)]),_:1})]),l("blockquote",Oe,"Describe: "+S(I(n).describe),1),Ue,g(Ce),I(s)?(f(),F(Ve,{key:0,onClose:o,user_info:I(n)},null,8,["user_info"])):E("",!0),l("section",Pe,[t.length>0?(f(),F(_e,{key:0,submission_list:t},null,8,["submission_list"])):E("",!0)])])}}}),je=N(Ae,[["__scopeId","data-v-68941ff4"]]);export{je as default};
